<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from admin.pixelstrap.com/wingo/theme/dashboard-03.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 05 Feb 2023 13:18:05 GMT -->

<head>
  <% include ../layouts/header.ejs %>
</head>

<body>
  <div class="page-wrapper compact-wrapper" id="pageWrapper">
    <% include ../layouts/page_main_header.ejs %>
      <div class="page-body-wrapper sidebar-icon">
        <% include ../layouts/main_nav.ejs %>
          <div class="page-body porject-dash">
            <!-- Container-fluid starts-->
            <div class="container-fluid project-dash">
              <div class="row size-column">
                <div class="col-xl-8 des-xl-100 congrats-sec-main box-col-12">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="card">
                        <div class="card-body p-0">
                          <div class="congrats-sec">
                            <div class="card-header-right">
                            </div>
                            <div class="congrats-content">
                              <h3>Chia sẻ cảm xúc cùng cộng đồng </h3>
                              <p>Chia sẻ những câu chuyện bạn muốn kể mà không có ai để có thể chia sẻ với mọi người. Đảm bảo 100% ẩn danh.</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-12 box-col-12 box-col-12">
                        <div class="card today-task-sec" style="border-radius: 15px">
                            <div class="card-body p-t-0">
                                <div>
                                 <br/>
                                    <div class="row">
                                       <div class="col-1" style="width: 5%; padding: 0px;">
                                     <img style="border-radius: 100%;" width="100%" src="https://scontent.fhan19-1.fna.fbcdn.net/v/t1.30497-1/143086968_2856368904622192_1959732218791162458_n.png?_nc_cat=1&ccb=1-7&_nc_sid=7206a8&_nc_ohc=HSy5184tsPEAX8o0zRJ&_nc_ht=scontent.fhan19-1.fna&oh=00_AfBW5PBC8UHSzvpa-2m223fwgEnDWe5psXoqM7UCceAcVA&oe=640E5878" alt="">
                                    </div>
                                    <div class="col-11">
                                         <p style="text-transform:none; font-weight: 700; margin-bottom: 0px;"><%= detail_posts.nickname %></p>
                                         <p style="font-weight: 300;"><%= moment(detail_posts.create_date).startOf('millies').fromNow() %></p>
                                         </div>
                                    </div><br>
                                    <p><%= detail_posts.content %></p>
                                    <img style="width: 100%;" src="./images/<%= detail_posts.img_posts %>" alt="">
                                </div>
                                <hr>
                                <div>
                                    <form action="/dashboard/bai-dang=<%= detail_posts._id %>" method="post" style="width: 100%;">
                                        <div class="row">
                                            <div class="col-10">
                                                <input type="hidden"  id="nickname" name="nickname" value="<%= detail_posts.nickname %>">
                                                <input type="hidden"  id="id_posts" name="id_posts" value="<%= detail_posts._id %>">
                                                <textarea class="form-control" class="form-control" id="comment" name="comment" placeholder="Viết bình luận..." style="height: 50px; border: none; resize: none; background-color: #eee;  border-radius: 25px; padding-top: 15px;"></textarea>
                                            </div>
                                            <div class="col-2">
                                                <button style="width: 100%; border-radius: 25px; padding: 12px; padding-left: 15%;" class="btn btn-primary btn-pill" type="submit">Đăng bình luận</button>
                                            </div>
                                        </div>
                                    </form>
                                    <% list_comment.forEach(function(list_comment){ %>
                                        <% if (detail_posts._id == list_comment.id_posts.id) { %>
                                        <div class="comment">
                                          <div class="row">
                                            <div class="col-2" style="width: 6%; padding: 0px; padding-left: 20px;">
                                              <img style="border-radius: 100%; margin-bottom: 5px;" width="100%" src="https://scontent.fhan19-1.fna.fbcdn.net/v/t1.30497-1/143086968_2856368904622192_1959732218791162458_n.png?_nc_cat=1&ccb=1-7&_nc_sid=7206a8&_nc_ohc=HSy5184tsPEAX8o0zRJ&_nc_ht=scontent.fhan19-1.fna&oh=00_AfBW5PBC8UHSzvpa-2m223fwgEnDWe5psXoqM7UCceAcVA&oe=640E5878" alt="">
                                            </div>
                                            <div class="col-10">
                                              <div style="background-color: #eee; color: #3d3d3d; padding: 10px; border-radius: 15px; display: table;">
                                                <b><%= list_comment.nickname %></b>
                                                <p><%= list_comment.comment %></p>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <% } %>
                                    <% }); %>
                                </div>
                            </div>
                        </div>
                    </div>
                  </div>
                </div>
                <div class="col-xl-4 des-xl-100 congrats-sec-main box-col-12">
                  
                  <div class="row">
                    <div class="col-md-12 box-col-12 box-col-12" style="position:fixed; overflow-x:hidden; height: 80%; width: 29%;">
                      <div class="card today-task-sec" style="height: 50px; margin-bottom: 5px; border-radius: 25px;">
                        <p style="padding: 2.5%;">Số người đang online: <span id="count">0</span></p>
                      </div>
                      <div class="card today-task-sec" style="margin-bottom: 10px; border-radius: 25px;">
                        <div class="card-body p-t-0 input-air-primary" style="height: 600px; border-radius: 25px; overflow: auto;">
                          <ul style="margin-top: 20px;">
                            <% list_message.forEach(function(list_message){ %>
                              <li class="my-message"><%= list_message.nickname %>: <%= list_message.message %></li>
                            <% }); %>
                          </ul>
                          <ul id="messages"></ul>
                        </div>
                      </div>
                      <div class="col-md-12 box-col-12 box-col-12">
                        <form action="dashboard/message" method="post" id="chat-form">
                          <div class="row">
                            <div class="col-md-12 box-col-12 box-col-12">
                              <div class="input-group pill-input-group">
                                <input type="hidden" id="nickname" name="nickname">
                                <input class="form-control btn-pill input-air-primary" style="border-radius: 25px 0 0 25px" id="message" name="message"  type="text">
                                <button class="input-group-text btn-pill input-air-primary" style="color: white; border: none; background-color: #4d8aff;">Gửi</button>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Container-fluid Ends-->
          </div>
      </div>
  </div>
  <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    // Hiển thị tổng số user đang online
    socket.on('usercnt', function(msg){
      document.getElementById("count").innerHTML=msg
    });
    // lấy nickname của user từ cookie
    var Nickname = document.cookie;
    document.querySelector("#nickname").value=`${Nickname}`;

    const chatForm = document.querySelector('#chat-form');
    const chatMes = document.querySelector('#message');
    chatForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const message = chatMes.value
      const new_message = {
        nickname: Nickname,
        message: message
      }
      $.post('http://localhost:3000/dashboard/message', new_message);
      socket.emit('on-chat', {
        Nickname,
        message: message
      });
      chatMes.value = ''
    })
    
    const messages = document.querySelector('#messages');
    socket.on('user-chat', (message) => {
      const chatItem = document.createElement("li");
      chatItem.classList.add("my-message")
      chatItem.innerHTML = `<b>${message.Nickname}</b> : ${message.message} `
      // chatItem.textContent = `${message.Nickname}: ${message.message}`;
      messages.appendChild(chatItem);
    })


    function readURL(input) {
      if (input.files && input.files[0]) {

        var reader = new FileReader();

        reader.onload = function(e) {
          $('.image-upload-wrap').hide();

          $('.file-upload-image').attr('src', e.target.result);
          $('.file-upload-content').show();

          $('.image-title').html(input.files[0].name);
        };

        reader.readAsDataURL(input.files[0]);

      } else {
        removeUpload();
      }
    }

    function removeUpload() {
      $('.file-upload-input').replaceWith($('.file-upload-input').clone());
      $('.file-upload-content').hide();
      $('.image-upload-wrap').show();
    }
    $('.image-upload-wrap').bind('dragover', function () {
        $('.image-upload-wrap').addClass('image-dropping');
      });
      $('.image-upload-wrap').bind('dragleave', function () {
        $('.image-upload-wrap').removeClass('image-dropping');
    });
  </script>
  <script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <!-- latest jquery-->
  <script src="../assets/js/jquery-3.5.1.min.js"></script>
  <!-- feather icon js-->
  <script src="../assets/js/icons/feather-icon/feather.min.js"></script>
  <script src="../assets/js/icons/feather-icon/feather-icon.js"></script>
  <!-- Sidebar jquery-->
  <script src="../assets/js/sidebar-menu.js"></script>
  <script src="../assets/js/config.js">   </script>
  <!-- Bootstrap js-->
  <script src="../assets/js/bootstrap/popper.min.js"></script>
  <script src="../assets/js/bootstrap/bootstrap.min.js"></script>
  <script src="../assets/js/dashboard/dashboard_3.js"></script>
  <!-- Plugins JS Ends-->
  <script src="../assets/js/script.js"></script>
  <!-- login js-->
  <!-- Plugin used-->
</body>

</html>